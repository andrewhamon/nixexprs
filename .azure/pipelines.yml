name: $(TeamProject).$(Build.DefinitionName).$(BuildID)$(Rev:.r)_$(SourceBranchName).$(Date:yyyyMMdd).$(Build.Reason)
schedules:
- cron: '30 3-7/2,13-21/4 * * *'
  displayName: Daytime builds
  always: true
  branches:
    include:
    - master
resources:
  repositories:
  - repository: ci
    type: github
    name: arcnmx/ci
    ref: refs/heads/master
    endpoint: github/arcnmx/ci
variables:
  CI_ALLOW_ROOT: true
  CI_CLOSE_STDIN: true
  CACHIX_CACHE: arc
  NIX_CHANNEL_HOME_MANAGER: master
  NIX_CHANNEL_MOZILLA: master
  imageLinux: ubuntu-latest
stages:
- template: stage.yml
- stage: deploy
  jobs:
  - job: nur
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'), not(eq(variables['Build.Reason'], 'Schedule')))
    pool:
      vmImage: ${{variables.imageLinux}}
    variables:
      NUR_REPO: arcnmx
    steps:
    - bash: curl -XPOST "https://nur-update.herokuapp.com/update?repo=$(NUR_REPO)"
      timeoutInMinutes: 1
      continueOnError: true
